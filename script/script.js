/***/
let wiki_mp = {
	"Albury":["Electoral_district_of_Albury","Justin Clancy","Liberal Party","undefined",57605,19686.86],
	"Auburn":["Electoral_district_of_Auburn","Lynda Voltz","Labor Party","Auburn, New South Wales",55340,39],
	"Ballina":["Electoral_district_of_Ballina","Tamara Smith","Greens","Ballina, New South Wales",59329,1059.16],
	"Balmain":["Electoral_district_of_Balmain","Jamie Parker","Greens","Balmain, New South Wales",57741,16.15],
	"Bankstown":["Electoral_district_of_Bankstown","Tania Mihailuk","Labor Party","Bankstown, New South Wales",54108,23],
	"Barwon":["Electoral_district_of_Barwon","Roy Butler","Shooters, Fishers, Farmers","Barwon River",55154,356291.7],
	"Bathurst":["Electoral_district_of_Bathurst","Paul Toole","The Nationals","undefined",56841,14992.77],
	"Baulkham Hills":["Electoral_district_of_Baulkham_Hills","David Elliott","Liberal Party","Baulkham Hills, New South Wales",55564,41],
	"Bega":["Electoral_district_of_Bega","Andrew Constance","Liberal Party","undefined",58131,9785.02],
	"Blacktown":["Electoral_district_of_Blacktown","Stephen Bali","Labor Party","Blacktown",55013,33.03],
	"Blue Mountains":["Electoral_district_of_Blue_Mountains","Trish Doyle","Labor Party","undefined",54885,1422.63],
	"Cabramatta":["Electoral_district_of_Cabramatta","Nick Lalich","Labor Party","undefined",54991,26],
	"Camden":["Electoral_district_of_Camden","Peter Sidgreaves","Liberal Party","undefined",70392,228],
	"Campbelltown":["Electoral_district_of_Campbelltown","Greg Warren","Labor Party","undefined",54579,199],
	"Canterbury":["Electoral_district_of_Canterbury","Sophie Cotsis","Labor Party","undefined",57164,18],
	"Castle Hill":["Electoral_district_of_Castle_Hill","Ray Williams","Liberal Party","Castle Hill",58240,99.95],
	"Cessnock":["Electoral_district_of_Cessnock","Clayton Barr","Labor Party","undefined",58268,4389.03],
	"Charlestown":["Electoral_district_of_Charlestown","Jodie Harrison","Labor Party","undefined",55720,66.18],
	"Clarence":["Electoral_district_of_Clarence","Chris Gulaptis","The Nationals","undefined",56859,13494.54],
	"Coffs Harbour":["Electoral_district_of_Coffs_Harbour","Gurmesh Singh","National Party","undefined",55338,1173.73],
	"Coogee":["Electoral_district_of_Coogee","Marjorie O'Neill","Labor","undefined",55037,12.69],
	"Cootamundra":["Electoral_district_of_Cootamundra","Steph Cooke","National Party","undefined",53474,34711.35],
	"Cronulla":["Electoral_district_of_Cronulla","Mark Speakman","Liberal Party","undefined",57275,65],
	"Davidson":["Electoral_district_of_Davidson","Jonathan O'Dea","Liberal Party","Sir Walter Davidson",54940,74.71],
	"Drummoyne":["Electoral_district_of_Drummoyne","John Sidoti","Independent","undefined",53969,25.49],
	"Dubbo":["Electoral_district_of_Dubbo","Dugald Saunders","National Party","Dubbo",55962,17352.89],
	"East Hills":["Electoral_district_of_East_Hills","Wendy Lindsay","Liberal Party","undefined",55144,39.55],
	"Epping":["Electoral_district_of_Epping","Dominic Perrottet","Liberal","Epping",54489,31.68],
	"Fairfield":["Electoral_district_of_Fairfield","Guy Zangari","Labor Party","Fairfield",53676,27.66],
	"Gosford":["Electoral_district_of_Gosford","Liesl Tesch","Labor","undefined",56435,867.15],
	"Goulburn":["Electoral_district_of_Goulburn","Wendy Tuckerman","Liberal Party","undefined",57564,18827.31],
	"Granville":["Electoral_district_of_Granville","Julia Finn","Labor Party","Granville",53545,22.64],
	"Hawkesbury":["Electoral_district_of_Hawkesbury","Robyn Preston","Liberal","Hawkesbury River",55753,3171.18],
	"Heathcote":["Electoral_district_of_Heathcote","Lee Evans","Liberal Party","undefined",56158,407.04],
	"Heffron":["Electoral_district_of_Heffron","Ron Hoenig","Labor Party","Bob Heffron",60576,35.28],
	"Holsworthy":["Electoral_district_of_Holsworthy","Melanie Gibbons","Liberal Party","undefined",56367,130.86],
	"Hornsby":["Electoral_district_of_Hornsby","Matt Kean","Liberal Party","undefined",55175,320.13],
	"Keira":["Electoral_district_of_Keira","Ryan Park","Labor Party","undefined",58824,204.43],
	"Kiama":["Electoral_district_of_Kiama","Gareth Ward","Independent","undefined",55490,2275.06],
	"Kogarah":["Electoral_district_of_Kogarah","Chris Minns","Labor Party","undefined",53226,18.13],
	"Ku-ring-gai":["Electoral_district_of_Ku","Alister Henskens","Liberal Party","Kuringgai",54441,52.45],
	"Lake Macquarie":["Electoral_district_of_Lake_Macquarie","Greg Piper","Independent","undefined",57686,531.46],
	"Lakemba":["Electoral_district_of_Lakemba","Jihad Dib","Labor Party","undefined",55253,23.7],
	"Lane Cove":["Electoral_district_of_Lane_Cove","Anthony Roberts","Liberal Party","undefined",57185,37.19],
	"Lismore":["Electoral_district_of_Lismore","Janelle Saffin","Labor","Lismore, New South Wales",56105,13020.61],
	"Liverpool":["Electoral_district_of_Liverpool","Paul Lynch","Labor Party","undefined",57573,29.3],
	"Londonderry":["Electoral_district_of_Londonderry","Prue Car","Labor Party","Londonderry",63842,184.74],
	"Macquarie Fields":["Electoral_district_of_Macquarie_Fields","Anoulack Chanthivong","Labor Party","undefined",61782,94.19],
	"Maitland":["Electoral_district_of_Maitland","Jenny Aitchison","Labor Party","undefined",60292,391.74],
	"Manly":["Electoral_district_of_Manly","James Griffin","Liberal","Manly",55672,26],
	"Maroubra":["Electoral_district_of_Maroubra","Michael Daley","Labor Party","undefined",56169,46.33],
	"Miranda":["Electoral_district_of_Miranda","Eleni Petinos","Liberal Party","undefined",54949,38.87],
	"Monaro":["Electoral_district_of_Monaro","John Barilaro","The Nationals","undefined",56951,20479.02],
	"Mount Druitt":["Electoral_district_of_Mount_Druitt","Edmond Atalla","Labor Party","Mount Druitt",56357,38.95],
	"Mulgoa":["Electoral_district_of_Mulgoa","Tanya Davies","Liberal Party","undefined",58259,272.66],
	"Murray":["Electoral_district_of_Murray","Helen Dalton","Shooters, Fishers, Farmers","Murray River",55784,107362.2],
	"Myall Lakes":["Electoral_district_of_Myall_Lakes","Stephen Bromhead","The Nationals","undefined",57689,5023.82],
	"Newcastle":["Electoral_district_of_Newcastle","Tim Crakanthorp","Labor Party","undefined",59126,121.22],
	"Newtown":["Electoral_district_of_Newtown","Jenny Leong","Greens","undefined",56412,10.29],
	"North Shore":["Electoral_district_of_North_Shore","Felicity Wilson","Liberal","undefined",55332,25.09],
	"Northern Tablelands":["Electoral_district_of_Northern_Tablelands","Adam Marshall","National Party","undefined",55371,53153.76],
	"Oatley":["Electoral_district_of_Oatley","Mark Coure","Liberal Party","undefined",53780,28.46],
	"Orange":["Electoral_district_of_Orange","Philip Donato","Shooters, Fishers and Farmers Party","Orange, New South Wales",56939,16981.25],
	"Oxley":["Electoral_district_of_Oxley_","Melinda Pavey","National Party","undefined",57131,9239.31],
	"Parramatta":["Electoral_district_of_Parramatta","Geoff Lee","Liberal Party","Parramatta",57023,36],
	"Penrith":["Electoral_district_of_Penrith","Stuart Ayres","Liberal Party","Penrith",56565,75.61],
	"Pittwater":["Electoral_district_of_Pittwater","Rob Stokes","Liberal Party","undefined",56138,190.16],
	"Port Macquarie":["Electoral_district_of_Port_Macquarie","Leslie Williams","Liberal","undefined",59974,1459.69],
	"Port Stephens":["Electoral_district_of_Port_Stephens","Kate Washington","Labor Party","Port Stephens",56476,1285.57],
	"Prospect":["Electoral_district_of_Prospect","Hugh McDermott","Labor Party","Prospect, New South Wales",54422,70.6],
	"Riverstone":["Electoral_district_of_Riverstone","Kevin Conolly","Liberal","Riverstone",59899,73.42],
	"Rockdale":["Electoral_district_of_Rockdale","Steve Kamper","Labor Party","undefined",56421,41.79],
	"Ryde":["Electoral_district_of_Ryde","Victor Dominello","Liberal Party","undefined",54881,28.23],
	"Seven Hills":["Electoral_district_of_Seven_Hills","Mark Taylor","Liberal Party","Seven Hills",53676,32.09],
	"Shellharbour":["Electoral_district_of_Shellharbour","Anna Watson","Labor Party","undefined",62909,292.39],
	"South Coast":["Electoral_district_of_South_Coast","Shelley Hancock","Liberal Party","undefined",56922,2799.02],
	"Strathfield":["Electoral_district_of_Strathfield","Jodi McKay","Labor Party","undefined",53451,22.8],
	"Summer Hill":["Electoral_district_of_Summer_Hill","Jo Haylen","Labor Party","undefined",56545,15.9],
	"Swansea":["Electoral_district_of_Swansea","Yasmin Catley","Labor Party","undefined",56681,191.45],
	"Sydney":["Electoral_district_of_Sydney","Alex Greenwich","Independent","undefined",55131,15.9],
	"Tamworth":["Electoral_district_of_Tamworth","Kevin Anderson","National Party","undefined",56751,21719.78],
	"Terrigal":["Electoral_district_of_Terrigal","Adam Crouch","Liberal Party","undefined",57504,128.45],
	"The Entrance":["Electoral_district_of_The_Entrance","David Mehan","Labor Party","undefined",56363,124.21],
	"Tweed":["Electoral_district_of_Tweed","Geoff Provest","National Party","undefined",56940,511.33],
	"Upper Hunter":["Electoral_district_of_Upper_Hunter","Dave Layzell","Nationals","undefined",56127,27687.5],
	"Vaucluse":["Electoral_district_of_Vaucluse","Gabrielle Upton","Liberal Party","undefined",56448,24.62],
	"Wagga Wagga":["Electoral_district_of_Wagga_Wagga","Joe McGirr","Independent","undefined",55688,12108.11],
	"Wakehurst":["Electoral_district_of_Wakehurst","Brad Hazzard","Liberal Party","John Loder, 2nd Baron Wakehurst",55814,0],
	"Wallsend":["Electoral_district_of_Wallsend","Sonia Hornery","Labor Party","undefined",59050,116.83],
	"Willoughby":["Electoral_district_of_Willoughby","Gladys Berejiklian","Liberal","undefined",54508,23.56],
	"Wollondilly":["Electoral_district_of_Wollondilly","Nathaniel Smith","Liberal","undefined",57397,3327.48],
	"Wollongong":["Electoral_district_of_Wollongong","Paul Scully","Labor Party","Wollongong",60829,79.25],
	"Wyong":["Electoral_district_of_Wyong","David Harris","Labor Party","undefined",57477,640.55]
}
let qldmayor = {
}
/***/

/*MAP SETUP*/
//Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIxY2JiMDhjMS1jODcyLTQxYWQtYmJiOC1hNTUyNDE0Zjg2N2YiLCJpZCI6NjQ3MDIsImlhdCI6MTYyOTQyMjY0OX0.XrBfYMVmvrlNeNuAdbcCyVHJ44KMq_yCGptHtZ1F9VY';
const extent = Cesium.Rectangle.fromDegrees(112.921124550164,-43.7429686004967,153.660861,-9.14118954253052);//(W,S,E,N)
Cesium.Camera.DEFAULT_VIEW_RECTANGLE = extent;
// Cesium.Camera.DEFAULT_VIEW_FACTOR = 0;

const osm = new Cesium.OpenStreetMapImageryProvider({
	// url:'https://a.tile.openstreetmap.org/'
	// url:'http://tile.stamen.com/watercolor'
	// url:'http://tile.stamen.com/toner-background'
	// url:'https://tile.stamen.com/toner-background'
	url:'https://{s}.basemaps.cartocdn.com/light_nolabels'
	// url:'mapbox://styles/mapbox/light-v10'
});
// Cesium.OpenStreetMapImageryProvider({url : 'https://a.tile.openstreetmap.org/'})
const viewer = new Cesium.Viewer('cesiumContainer', {
	// imageryProvider: new Cesium.IonImageryProvider({ assetId: 3954 }),//asset added to account
	imageryProvider: osm,
	// imageryProvider: false,
	// terrainProvider: Cesium.createWorldTerrain(),
	timeline: false,
	animation: false,
	geocoder: false,
	baseLayerPicker: false,////////////////////////
	sceneModePicker: false,
	navigationHelpButton: false,
	homeButton: false,
	fullscreenButton: false,
	skyBox: false,

	// imageryProvider: Cesium.createWorldImagery({
	// 	style: Cesium.IonWorldImageryStyle.AERIAL_WITH_LABELS,
	// }),

	// selectionIndicator : false,
	// infoBox : false,

	// sceneMode: Cesium.SceneMode.SCENE2D,
	// mapMode2D: Cesium.MapMode2D.ROTATE,
});

let stateBoundaries = new Cesium.CustomDataSource("stateBoundaries")
let localities = new Cesium.CustomDataSource("localities")
let lgas = new Cesium.CustomDataSource("lgas")
let stateDivisions = new Cesium.CustomDataSource("stateDivisions")
let federal = new Cesium.CustomDataSource("federal")
let zones = new Cesium.CustomDataSource("zones")
let broadcast = new Cesium.CustomDataSource("broadcast")

viewer.dataSources.add(stateBoundaries);
viewer.dataSources.add(localities);
viewer.dataSources.add(lgas);
viewer.dataSources.add(stateDivisions);
viewer.dataSources.add(federal);
viewer.dataSources.add(zones);
viewer.dataSources.add(broadcast);


//viewer.scene.globe.depthTestAgainstTerrain = true;//https://community.cesium.com/t/render-polygons-on-ground/7096//2109101041

lgas.show = false;
stateDivisions.show = false;
federal.show = false;
// zones.show = true;
zones.show = false;
broadcast.show = false;
// localities.show = false;
/*MAP SETUP*/

/*GLOBAL VARIABLES*/
const colours = [[255,0,0],[255,106,0],[255,213,0],[191,255,0],[84,255,0],[0,255,22],[0,255,128],[0,255,234],[0,169,255],[0,63,255],[42,0,255],[148,0,255],[254,0,253],[255,0,147],[255,0,41],[255,64,0],[255,170,0],[233,255,0],[127,255,0],[21,255,0],[0,255,86],[0,255,192],[0,211,255],[0,105,255],[0,0,255],[106,0,255],[212,0,255],[255,0,190],[255,0,83],[255,21,0],[255,128,0],[255,234,0],[169,255,0],[63,255,0],[0,255,43],[0,255,149],[0,254,255],[0,148,255],[0,41,255],[63,0,255],[169,0,255],[255,0,232],[255,0,126],[255,0,20],[255,85,0],[255,191,0],[212,255,0],[106,255,0],[1,255,1],[0,255,107],[0,255,213],[0,190,255],[0,84,255],[21,0,255],[127,0,255],[233,0,255],[255,0,168],[255,0,62],[255,43,0],[255,149,0]]

const stateBox = {//W,S,E,N
	// NSW:[140.999286483091,-37.5052674371251,159.105448901665,-28.157007484129],
	NSW:[140.999286483091,-37.5052674371251,153.660861,-28.157007484129],
	QLD:[137.99596539614,-29.1778849996844,153.555247484414,-9.14118954253052],
	VIC:[140.961865804717,-39.1591796902753,149.976504105742,-33.980636405904],
	TAS:[143.818576726639,-43.7429686004967,148.50313834661,-39.1919773009046],
	SA:[129.001348803946,-38.0625895910114,141.002962544954,-25.996363071308],
	WA:[112.921124550164,-35.134832521502,129.001862438231,-13.6894781340124],
	NT:[129.000484929137,-25.9986044823092,138.001207833215,-10.965900135588],
	ACT:[148.762795689483,-35.920517211112,149.399292549604,-35.1244029421091],
	// ACT:[148.762795689483,-35.920517211112,150.765777,-35.1178241],//including jervis bay territory

	AUS:[112.921124550164,-43.7429686004967,153.660861,-9.14118954253052]
}

const stateColours = {
	NSW:[0,170,255],
	QLD:[150,50,100],
	VIC:[45,45,50],
	TAS:[0,140,75],
	SA:[255,0,0],
	WA:[220,160,0],
	NT:[255,100,0],
	ACT:[255,200,0]
}

let selections = {
	stateBoundaries:{},
	clear:{},
	lgas:{},
	stateDivisions:{},
	federal:{},
	zones:{},
	broadcast:{},
	localities:{},
}
let guidSelect = {
	stateBoundaries:{},
	clear:{},
	lgas:{},
	stateDivisions:{},
	federal:{},
	zones:{},
	broadcast:{},
	localities:{},
}
/*GLOBAL VARIABLES*/

/*H*O*V*E*R*/
/*const hoverLabel = viewer.entities.add({
	label: {
		show: false,
		showBackground: true,
		horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
		verticalOrigin: Cesium.VerticalOrigin.TOP,
		pixelOffset: new Cesium.Cartesian2(15, 0),
	},
});

const handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);

const mouseMove = (e)=>{
	$('.tooltip').css({
		left:`${e.clientX}px`,
		top:`${e.clientY}px`
	})
}
$('body').on('mousemove',mouseMove)

handler.setInputAction((movement)=>{
	let pickedObject = viewer.scene.pick(movement.endPosition);

	// switch(true){
	// 	case !Cesium.defined(pickedObject) && window['hover'] == undefined://there is no entity AND there WASN'T one
	// 	case Cesium.defined(pickedObject) && pickedObject['collection'] != undefined://there IS an entity but it's a label
	// 	return false;

	// 	case window['hover'] != undefined && pickedObject != window['hover']://there was an entity but not this one
	// 	window['hover']['id']['label']['show'] = false;
	// 	break;
	// }

	switch(true){
		case !Cesium.defined(pickedObject)://there is no entity
		$('.tooltip').html('').addClass('displayNone');
		// case pickedObject['collection'] != undefined://the entity is a label//captioned out for including localities
		// hoverLabel.label.show = false;
		return false;
	}

	let owner = pickedObject['id']['entityCollection']['_owner']['_name']

	switch(owner){
		case 'lgas':
		case 'stateDivisions':
		case 'federal':
		case 'zones':
		case 'broadcast':
		
		case 'localities':

		$('.tooltip').html(`<span>${pickedObject['id']['_label']['_text']['_value']}</span>`).removeClass('displayNone');
		
		// pickedObject.id.label.show = true;
		// window['hover'] = pickedObject;

		// let cartesian = viewer.camera.pickEllipsoid(movement.endPosition,viewer.scene.globe.ellipsoid);
		// let cartographic = Cesium.Cartographic.fromCartesian(cartesian);
		// let longitudeString = Cesium.Math.toDegrees(cartographic.longitude).toFixed(2);
		// let latitudeString = Cesium.Math.toDegrees(cartographic.latitude).toFixed(2);
		// hoverLabel.position = cartesian;
		// hoverLabel.label.show = true;
		// hoverLabel.label.text = pickedObject['id']['_label']['_text']['_value'];
		
		break;

		// default: return false;
		// default: hoverLabel.label.show = false; break;
		default: $('.tooltip').html('').addClass('displayNone'); break;
	}
}, Cesium.ScreenSpaceEventType.MOUSE_MOVE);*/
/*H*O*V*E*R*/

/*FUNCTIONS*/
viewer.trackedEntityChanged.addEventListener((e)=>{
	// console.log(e)
})
viewer.selectedEntityChanged.addEventListener((e)=>{

	viewer.trackedEntity = undefined;

	/*alpha channel*/
	if(window['polygons'] != undefined){//there is an array of polygons in memory
		for(let i in window['polygons']){
			let p = window['polygons'][i]
			let rgba = p['_polygon']['_material']['_color']['_value']
			let R = rgba['red']
			let G = rgba['green']
			let B = rgba['blue']
			let nc = new Cesium.Color(R,G,B,0.25)
			p.polygon.material = nc
			p.polygon.outline = false
		}
	}
	/*alpha channel*/
	
	if(e == undefined){//clicked out of polygon or cleared selection
		let b = stateBox[$('.stateSelect').val()];
		$('.areaFocus').val('clear')
		viewer.camera.flyTo({
			destination : Cesium.Rectangle.fromDegrees(b[0],b[1],b[2],b[3])
		});
		return false
	}else{
		/*selection indicator*/
		switch(!e['_polygon']){//selected entity is a point or label
			case false: $('.cesium-viewer-selectionIndicatorContainer').addClass('displayNone'); break;
			case true:
			setTimeout(()=>{
				$('.cesium-viewer-selectionIndicatorContainer').removeClass('displayNone')
			},250);
			break;
		}
		/*selection indicator*/

		let id = e['_id']
		let name = e['_name']
		let owner = e['entityCollection']['_owner']['_name']
		let entGroup = guidSelect[owner][e['entGroup']]
		
		switch(owner){

			case 'stateBoundaries':

			let prevVal = $('.stateSelect').val()

			if($('.stateSelect').val() != name){
				$('.stateSelect').val(name);
			}
			
			viewer.selectedEntity = undefined;
			viewer.trackedEntity = undefined;
			
			if(prevVal != name){
				stateSelect(name)
			}

			break;

			case 'lgas':
			case 'stateDivisions':
			case 'federal':
			case 'zones':
			case 'broadcast':
		
			$('.areaFocus').val(entGroup[0])
			// e.label.show = false
			let b = e['_boundingBox']
			
			/*alpha channel*/
			let rgba = e['_polygon']['_material']['_color']['_value']
			let R = rgba['red']
			let G = rgba['green']
			let B = rgba['blue']
			let nc = new Cesium.Color(R,G,B,0.5)

			window['polygons'] = []
		
			for(let i in entGroup){
				let p = window['currentEntities'][entGroup[i]]
				window['polygons'].push(p)
				p.polygon.material = nc
				p.polygon.outline = true
			}
			/*alpha channel*/
			
			viewer.camera.flyTo({
				destination : Cesium.Rectangle.fromDegrees(b['W'],b['S'],b['E'],b['N'])
			});

			break;			
		}
	}
})

const toTitleCase = (str)=>{
	return str.replace(
		/\w\S*/g,
		(txt)=>{
			// return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
			return (txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()).replace(/Mcc/g,'McC').replace(/O'c/,`O'C`);
		}
	);
}

const wordWrap = (str)=>{

	str = toTitleCase(str)

	let words = str.split(' ')
	let len = words.length
	let out;

	if(len > 1){

		let parity = len % 2;

		let lo = Math.floor(len / 2) - 1;
		let hi = Math.ceil(len / 2) - 1;

		let a = words[0]
		let aa = words[0]
		let b = '';
		let bb = '';

		for(let i = 1; i < len; i++){

			if(i <= lo){
				a += ` ${words[i]}`
				aa += ` ${words[i]}`
			}
			if(i == hi && parity == 1){
				aa += ` ${words[i]}`
				bb += `${words[i]}`
			}
			if(i > hi){
				b += ` ${words[i]}`
				bb += ` ${words[i]}`
			}
		}

		if(Math.abs(a.length - bb.length) < Math.abs(aa.length - b.length)){
			out = `${a}\n${bb}`;
		}else{
			out = `${aa}\n${b}`;
		}
	}else{
		// console.log(toTitleCase(str))
		return toTitleCase(str)
	}

	return out.replace(/\n /g,'\n')
}

const numberWithCommas = (x)=>{
	return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

const decimalise = (val,dec)=>{	
	let multiplier = Number(`1e${dec}`)
	let result = Math.round(Number(val) * multiplier) / multiplier
	return numberWithCommas(result)
}

const listSelections = (a)=>{

	if($(`.areaSelect option[value="${window['selectedArea']}"]`).prop('disabled') == true){
		$('.areaSelect').val('clear');
		$('.areaFocus').prop('disabled',true).val('clear');
		$('#dynamicOption').html('Select Division');
		return false;
	}

	if(a === null || a == 'clear' || a == 'deselect'){
		$('.areaSelect').prop('disabled',false);
		$('.areaFocus').prop('disabled',true).val('clear');//
	}else{
	
		let s = Object.keys(selections[a]).sort();
		let d;

		switch(a){
			case 'lgas': d = 'LGA'; break;
			case 'stateDivisions':d = 'Electorate'; break;
			case 'federal':d = 'Electorate'; break;
			case 'zones':d = 'Zone'; break;
		}

		$('.areaFocus').html(`
			<option selected hidden value="clear" id="dynamicOption">Select ${d}</option>
			<option value="deselect" id="clearAreaSelection">None</option>
		`)
		
		for(let i in s){
			// console.log(s[i])
			$('.areaFocus').append(`<option value="${selections[a][s[i]][0]}">${toTitleCase(s[i])}</option>`)
		}

		$('.areaSelect, .areaFocus').prop('disabled',false);
	}
};

/*ENTITY FUNCTIONS*/
const loadLocalities = (state)=>{
	let propName = `localities_${state}`
	if(typeof(window[propName]) !== 'object'){
		let info = fetch(`script/localities/${state}.json`,{
			method: 'get',
			headers: {'Content-Type': 'application/json'}
		})
		.then((response) => response.json())
		.then((response) => {
			Object.defineProperty(window, propName, {
				value: response,
				configurable: false,
				writable: false
			})
		})
		.then(() => {
			appendLocalities(window[propName],state)
		})
		.catch(err => console.error('Caught error: ', err))
	}else{
		appendLocalities(window[propName],state)
	}
};

const appendLocalities = (o,state)=>{
	// console.log(o.length)
	for(let i in o){
		let description = `Population: ${numberWithCommas(o[i]['population'])}`
		let colour = Cesium.Color.GREEN;
		let pixelSize = 5;
		switch(true){
			case Number(o[i]['population']) >= 12e3:
			colour = Cesium.Color.RED;
			pixelSize = 15;
			break;
			
			case Number(o[i]['population']) >= 1500:
			colour = Cesium.Color.BLUE;
			pixelSize = 10;
			break;
		}

		localities.entities.add({
			name: o[i]['locality'],
			description: description,
			position: Cesium.Cartesian3.fromDegrees(o[i]['long'], o[i]['lat'],500),
			point: {
				pixelSize : pixelSize,
				color : colour,
				outlineColor : Cesium.Color.WHITE,
				outlineWidth : 2,
				translucencyByDistance: new Cesium.NearFarScalar(100000, 1, 5000000, 0),
				depthTestAgainstTerrain: false,
			},
			label: {
				text: o[i]['locality'],
				// style: Cesium.LabelStyle.FILL_AND_OUTLINE,
				// style: Cesium.LabelStyle.FILL,
				// outlineWidth : 0,
				fillColor: Cesium.Color.BLACK,
				verticalOrigin : Cesium.VerticalOrigin.BOTTOM,
				pixelOffset : new Cesium.Cartesian2(0, -9),
				scaleByDistance: new Cesium.NearFarScalar(50000, 1, 5000000, 0),
				translucencyByDistance: new Cesium.NearFarScalar(100000, 1, 5000000, 0),
				depthTestAgainstTerrain: false,
			},
			// boundingBox: {W:W,E:E,S:S,N:N}
		})
		let guid = localities['_entityCollection']['_entities']['_array'][i]['_id']
		window['currentEntities'][guid] = lgas['_entityCollection']['_entities']['_array'][i]
		selections['localities'][o[i]['locality']] = guid
	}
	// viewer.zoomTo(viewer.entities);

	// console.log(selections)
	listSelections($('.areaSelect').val())
};

const loadLGAs = (state)=>{
	let propName = `lgas_${state}`
	if(typeof(window[propName]) !== 'object'){
		let info = fetch(`script/lgas/${state}.json`,{
			method: 'get',
			headers: {'Content-Type': 'application/json'}
		})
		.then((response) => response.json())
		.then((response) => {
			Object.defineProperty(window, propName, {
				value: response['features'],
				configurable: false,
				writable: false
			})
		})
		.then(() => {
			appendLGAs(window[propName],state)
		})
		.catch(err => console.error('Caught error: ', err))
	}else{
		appendLGAs(window[propName],state)
	}
}

const appendLGAs = (o,state)=>{

	$('.areaSelect option[value="lgas"]').prop('disabled',o.length <= 0);
	// $('.areaSelect option[value="lgas"]').prop('disabled',state != 'QLD');

	if(o.length <= 0){
		if($('.areaSelect').val() == 'lgas'){
			$('.areaSelect').val('clear')
		}
		lgas.show = false
		loadLocalities(state)
		return false;
	}

	// console.log(o.length)
	let repNames = {}
	let thisCol = 0;
	let thisName;
	let entGroup;

	if(o[0]['properties']['NSW_LGA__2']){
		thisName = o[0]['properties']['NSW_LGA__2']
	}else if(o[0]['properties']['QLD_LGA__2']){
		thisName = o[0]['properties']['QLD_LGA__2']
	}else{
		thisName = o[0]['properties']['LGA_NAME']
	}

	

	let r = colours[0][0] / 255;
	let g = colours[0][1] / 255;
	let b = colours[0][2] / 255;
	let colour = new Cesium.Color(r,g,b,0.25);

	/*SETUP FOR BOUNDING BOXES - SAVE RESULT TO JSON FILE - CAPTION OUT WHEN NOT IN USE*/

	// let W = 180;//lower lon
	// let E = -180;//higher lon
	// let S = 90;//lower lat
	// let N = -90;//higher lat

	// let boxes = {}

	for(let i in o){
		
		let LGA_NAME

		if(o[i]['properties']['NSW_LGA__2']){
			LGA_NAME = o[i]['properties']['NSW_LGA__2']
		}else if(o[i]['properties']['QLD_LGA__2']){
			LGA_NAME = o[i]['properties']['QLD_LGA__2']
		}else{
			LGA_NAME = o[i]['properties']['LGA_NAME']
		}

		// let coords = o[i]['geometry']['coordinates'][0]

		if(!repNames[LGA_NAME]){
			repNames[LGA_NAME] = 1
			// boxes[LGA_NAME] = {}
			// W = 180;
			// E = -180;
			// S = 90;
			// N = -90;
		}else{
			repNames[LGA_NAME] ++
		}

		// for(let i in coords){
		// 	if(coords[i][0] < W){W = coords[i][0]}
		// 	if(coords[i][0] > E){E = coords[i][0]}
		// 	if(coords[i][1] < S){S = coords[i][1]}
		// 	if(coords[i][1] > N){N = coords[i][1]}

		// 	boxes[LGA_NAME]['W'] = W
		// 	boxes[LGA_NAME]['E'] = E
		// 	boxes[LGA_NAME]['S'] = S
		// 	boxes[LGA_NAME]['N'] = N
		// }
	}

	// for(let i in o){
		
	// 	let LGA_NAME

	// 	if(o[i]['properties']['NSW_LGA__2']){
	// 		LGA_NAME = o[i]['properties']['NSW_LGA__2']
	// 	}else if(o[i]['properties']['QLD_LGA__2']){
	// 		LGA_NAME = o[i]['properties']['QLD_LGA__2']
	// 	}else{
	// 		LGA_NAME = o[i]['properties']['LGA_NAME']
	// 	}

	// 	o[i]['properties']['boundingBox'] = boxes[LGA_NAME]
	// }

	// console.log(o)
	// console.log(JSON.stringify(o))
	// return false;

	/*SETUP FOR BOUNDING BOXES - SAVE RESULT TO JSON FILE - CAPTION OUT WHEN NOT IN USE*/

	let k = Object.keys(repNames)
	let colourStep = Math.floor(colours.length / k.length);

	for(let i in o){

		let W = o[i]['properties']['boundingBox']['W']
		let E = o[i]['properties']['boundingBox']['E']
		let S = o[i]['properties']['boundingBox']['S']
		let N = o[i]['properties']['boundingBox']['N']

		let midLat = (S + N) / 2
		let midLon = (W + E) / 2

		let LGA_NAME

		if(o[i]['properties']['NSW_LGA__2']){
			LGA_NAME = o[i]['properties']['NSW_LGA__2']
		}else if(o[i]['properties']['QLD_LGA__2']){
			LGA_NAME = o[i]['properties']['QLD_LGA__2']
		}else{
			LGA_NAME = o[i]['properties']['LGA_NAME']
		}

		let coords = o[i]['geometry']['coordinates'][0]
		let boundary = []

		/***/
		// console.log(qldmayor[LGA_NAME])
		// o[i]['properties']['mayor'] = qldmayor[LGA_NAME][0]
		// o[i]['properties']['url'] = qldmayor[LGA_NAME][1]
		/***/

		let mayor = o[i]['properties']['mayor']
		let url = o[i]['properties']['url']
		let description = ''
		
		if(url != undefined){
			description = `
			Mayor:&nbsp;${mayor}<br>
			Website:&nbsp;<a href="${url}" target="_blank">${url.replace(/https:\/\//g,'').replace(/www\./g,'')}</a>
			`
		}

		if(thisName !== LGA_NAME || i == 0){//It's a new division - reset colour

			thisCol += Math.max(colourStep,1)
			
			if(thisCol >= colours.length - 1){
				thisCol = 0;
			}

			r = colours[thisCol][0] / 255
			g = colours[thisCol][1] / 255
			b = colours[thisCol][2] / 255
			colour = new Cesium.Color(r,g,b,0.25)

			let W_ = 180;//lower lon
			let E_ = -180;//higher lon
			let S_ = 90;//lower lat
			let N_ = -90;//higher lat

			for(let i in coords){
				boundary.push(coords[i][0],coords[i][1])

				if(coords[i][0] < W_){W_ = coords[i][0]}
				if(coords[i][0] > E_){E_ = coords[i][0]}
				if(coords[i][1] < S_){S_ = coords[i][1]}
				if(coords[i][1] > N_){N_ = coords[i][1]}
			}

			// let midLat = (S + N) / 2
			// let midLon = (W + E) / 2

			lgas.entities.add({
				name: LGA_NAME,
				description:description,
				polygon: {
					hierarchy: Cesium.Cartesian3.fromDegreesArray(boundary),
					height : 0,
					material : colour,
					outline : false,
					outlineColor : Cesium.Color.BLACK,
				},
				position: Cesium.Cartesian3.fromDegrees(midLon, midLat, 1000),
				label: {
					text: wordWrap(LGA_NAME),
					fillColor: Cesium.Color.BLUE,
					scaleByDistance: new Cesium.NearFarScalar(50000, 1.5, 5000000, 0),
					translucencyByDistance: new Cesium.NearFarScalar(50000, 0, 100000, 1),
					depthTestAgainstTerrain: false,
				},
				boundingBox: {W:W,E:E,S:S,N:N}
			})

			let guid = lgas['_entityCollection']['_entities']['_array'][i]['_id']
			entGroup = guid//defined at first polygon in the group

			window['currentEntities'][guid] = lgas['_entityCollection']['_entities']['_array'][i]

			lgas['_entityCollection']['_entities']['_array'][i]['entGroup'] = entGroup//add the attribute to the entity
			guidSelect['lgas'][entGroup] = [guid]//store unique id in an array to loop over

			selections['lgas'][LGA_NAME] = [guid]

			thisName = LGA_NAME//string for division name
		}else{

			for(let i in coords){
				boundary.push(coords[i][0],coords[i][1])
			}

			lgas.entities.add({
				name: LGA_NAME,
				description: description,
				polygon: {
					hierarchy: Cesium.Cartesian3.fromDegreesArray(boundary),
					height: 0,
					material : colour,
					outline : false,
					outlineColor : Cesium.Color.BLACK,
				},
				boundingBox: {W:W,E:E,S:S,N:N},
				colour: colour,
				entGroup:entGroup//add the entGroup attribute to the entity
			})

			let guid = lgas['_entityCollection']['_entities']['_array'][i]['_id']
			window['currentEntities'][guid] = lgas['_entityCollection']['_entities']['_array'][i]

			guidSelect['lgas'][entGroup].push(guid)//store unique id in an array to loop over
			selections['lgas'][LGA_NAME].push(guid)
		}
	}
	loadLocalities(state)
	// console.log(JSON.stringify(repNames))
	// let k = Object.keys(repNames)
	// console.clear()
	// for(let i in k){
	// 	if(repNames[k[i]] > 1){
	// 		console.log(k[i],repNames[k[i]])
	// 	}
	// }
	// console.log(JSON.stringify(o))
}

const loadStateDivisions = (state)=>{
	let propName = `stateDivisions_${state}`
	if(typeof(window[propName]) !== 'object'){
		let info = fetch(`script/statedivisions/${state}.json`,{
			method: 'get',
			headers: {'Content-Type': 'application/json'}
		})
		.then((response) => response.json())
		.then((response) => {
			Object.defineProperty(window, propName, {
				value: response['features'],
				configurable: false,
				writable: false
			})
		})
		.then(() => {
			appendStateDivisions(window[propName],state)
		})
		.catch(err => console.error('Caught error: ', err))
	}else{
		appendStateDivisions(window[propName],state)
	}
}

const appendStateDivisions = (o,state)=>{

	$('.areaSelect option[value="stateDivisions"]').prop('disabled',o.length <= 0);
	if(o.length <= 0){
		if($('.areaSelect').val() == 'stateDivisions'){
			$('.areaSelect').val('clear')
		}
		stateDivisions.show = false
		loadLGAs(state)
		return false;
	}
	
	let repNames = {}
	let thisCol = 0;
	// console.log(o.length)
	let entGroup
	let thisName = o[0]['properties']['NAME']

	let r = colours[0][0] / 255;
	let g = colours[0][1] / 255;
	let b = colours[0][2] / 255;
	let colour = new Cesium.Color(r,g,b,0.25);

	/*SETUP FOR BOUNDING BOXES - SAVE RESULT TO JSON FILE - CAPTION OUT WHEN NOT IN USE*/

	let W = 180;//lower lon
	let E = -180;//higher lon
	let S = 90;//lower lat
	let N = -90;//higher lat

	let boxes = {}

	for(let i in o){
		
		let NAME = o[i]['properties']['NAME']
		let coords = o[i]['geometry']['coordinates'][0]

		if(!repNames[NAME]){
			repNames[NAME] = 1
			boxes[NAME] = {}
			W = 180;
			E = -180;
			S = 90;
			N = -90;
		}else{
			repNames[NAME] ++
		}

		for(let i in coords){
			if(coords[i][0] < W){W = coords[i][0]}
			if(coords[i][0] > E){E = coords[i][0]}
			if(coords[i][1] < S){S = coords[i][1]}
			if(coords[i][1] > N){N = coords[i][1]}

			boxes[NAME]['W'] = W
			boxes[NAME]['E'] = E
			boxes[NAME]['S'] = S
			boxes[NAME]['N'] = N
		}
	}

	for(let i in o){
		let NAME = o[i]['properties']['NAME'];//console.log(toTitleCase(NAME).replace(/ /g,'_'))
		o[i]['properties']['boundingBox'] = boxes[NAME]
	}

	// console.log(o)
	// console.log(JSON.stringify(o))
	// return false;

	/*SETUP FOR BOUNDING BOXES - SAVE RESULT TO JSON FILE - CAPTION OUT WHEN NOT IN USE*/

	let k = Object.keys(repNames)
	let colourStep = Math.floor(colours.length / k.length);

	for(let i in o){

		/***/
		// // console.log(toTitleCase(NAME))
		// // console.log(wiki_mp[toTitleCase(NAME)][0])
		let NAME = o[i]['properties']['NAME']
		// console.log(toTitleCase(NAME).replace(/ /g,'_'))
		// o[i]['properties']['wiki'] = wiki_mp[toTitleCase(NAME)][0]
		// o[i]['properties']['mp'] = wiki_mp[toTitleCase(NAME)][1]
		// o[i]['properties']['party'] = wiki_mp[toTitleCase(NAME)][2]
		// o[i]['properties']['namesake'] = wiki_mp[toTitleCase(NAME)][3]
		// o[i]['properties']['electors'] = wiki_mp[toTitleCase(NAME)][4]
		// o[i]['properties']['Area_SqKm'] = wiki_mp[toTitleCase(NAME)][5]
		/***/

		let W = o[i]['properties']['boundingBox']['W']
		let E = o[i]['properties']['boundingBox']['E']
		let S = o[i]['properties']['boundingBox']['S']
		let N = o[i]['properties']['boundingBox']['N']

		let midLat = (S + N) / 2
		let midLon = (W + E) / 2

		// let NAME = o[i]['properties']['NAME']
		// let NAME = o[i]['properties']['SA_STATE_2']
		let mp = o[i]['properties']['mp']
		let party = o[i]['properties']['party']
		let namesake = o[i]['properties']['namesake']
		let electors = o[i]['properties']['electors']
		let Area_SqKm = o[i]['properties']['Area_SqKm']
		let wiki = o[i]['properties']['wiki']

		let description 
		
		if(state == 'QLD' || state == 'NSW'){
			description = `
			Area:&nbsp;${decimalise(Area_SqKm,2)}&nbsp;km<sup>2</sup><br>
			Member:&nbsp;${mp} - ${party}<br>
			<!--Electors:&nbsp;${electors}<br>-->
			<!--Namesake:&nbsp;${namesake}<br>-->
			Wiki:&nbsp;<a href="https://en.wikipedia.org/wiki/${wiki}" target="_blank">${toTitleCase(NAME)}</a>
			`
		}
		/***/

		let coords = o[i]['geometry']['coordinates'][0]
		let boundary = []

		if(thisName !== NAME || i == 0){//It's a new division - reset colour

			thisCol += Math.max(colourStep,1)

			if(thisCol >= colours.length - 1){
				thisCol = 0;
			}
			
			r = colours[thisCol][0] / 255
			g = colours[thisCol][1] / 255
			b = colours[thisCol][2] / 255
			colour = new Cesium.Color(r,g,b,0.25)

			let W_ = 180;//lower lon
			let E_ = -180;//higher lon
			let S_ = 90;//lower lat
			let N_ = -90;//higher lat

			for(let i in coords){
				boundary.push(coords[i][0],coords[i][1])

				if(coords[i][0] < W_){W_ = coords[i][0]}
				if(coords[i][0] > E_){E_ = coords[i][0]}
				if(coords[i][1] < S_){S_ = coords[i][1]}
				if(coords[i][1] > N_){N_ = coords[i][1]}
			}

			// let midLat = (S + N) / 2
			// let midLon = (W + E) / 2

			stateDivisions.entities.add({
				// name: `State Electorate of ${toTitleCase(NAME)}`,
				name: NAME,
				description: description,
				polygon: {
					hierarchy: Cesium.Cartesian3.fromDegreesArray(boundary),
					height : 0,
					material : colour,
					outline : false,
					outlineColor : Cesium.Color.BLACK,
				},
				position: Cesium.Cartesian3.fromDegrees(midLon, midLat, 5000),
				label: {
					text: wordWrap(NAME),
					fillColor: Cesium.Color.BLUE,
					scaleByDistance: new Cesium.NearFarScalar(50000, 1.25, 5000000, 0.5),
					translucencyByDistance: new Cesium.NearFarScalar(50000, 0, 100000, 1),
					depthTestAgainstTerrain: false,
					// show: false,
				},
				boundingBox: {W:W,E:E,S:S,N:N},
				colour: colour
			})

			let guid = stateDivisions['_entityCollection']['_entities']['_array'][i]['_id']
			entGroup = guid//defined at first polygon in the group

			window['currentEntities'][guid] = stateDivisions['_entityCollection']['_entities']['_array'][i]

			stateDivisions['_entityCollection']['_entities']['_array'][i]['entGroup'] = entGroup//add the attribute to the entity
			guidSelect['stateDivisions'][entGroup] = [guid]//store unique id in an array to loop over

			selections['stateDivisions'][NAME] = [guid]

			thisName = NAME//string for division name
		}else{

			for(let i in coords){
				boundary.push(coords[i][0],coords[i][1])
			}

			stateDivisions.entities.add({
				name: NAME,
				description: description,
				polygon: {
					hierarchy: Cesium.Cartesian3.fromDegreesArray(boundary),
					height: 0,
					material : colour,
					outline : false,
					outlineColor : Cesium.Color.BLACK,
				},
				boundingBox: {W:W,E:E,S:S,N:N},
				colour: colour,
				entGroup:entGroup//add the entGroup attribute to the entity
			})

			let guid = stateDivisions['_entityCollection']['_entities']['_array'][i]['_id']
			window['currentEntities'][guid] = stateDivisions['_entityCollection']['_entities']['_array'][i]

			guidSelect['stateDivisions'][entGroup].push(guid)//store unique id in an array to loop over
			selections['stateDivisions'][NAME].push(guid)
		}
	}
	loadLGAs(state)
	// console.log(JSON.stringify(repNames))
	// let k = Object.keys(repNames)
	// for(let i in k){
	// 	if(repNames[k[i]] > 1){
	// 		console.log(k[i],repNames[k[i]])
	// 	}
	// }
	// console.log(JSON.stringify(o))
	// console.log(o)
}

const loadFederal = (state)=>{
	let propName = `federal_${state}`
	if(typeof(window[propName]) !== 'object'){
		let info = fetch(`script/federal/${state}.json`,{
			method: 'get',
			headers: {'Content-Type': 'application/json'}
		})
		.then((response) => response.json())
		.then((response) => {
			Object.defineProperty(window, propName, {
				value: response['features'],
				configurable: false,
				writable: false
			})
		})
		.then(()=>{
			appendFederal(window[propName],state)
		})
		.catch(err => console.error('Caught error: ', err))
	}else{
		appendFederal(window[propName],state)
	}
}

const appendFederal = (o,state)=>{

	$('.areaSelect option[value="federal"]').prop('disabled',o.length <= 0);
	if(o.length <= 0){
		if($('.areaSelect').val() == 'federal'){
			$('.areaSelect').val('clear')
		}
		federal.show = false
		loadStateDivisions(state)
		return false;
	}

	let repNames = {}
	let thisCol = 0;
	// console.log(o.length)
	
	let thisName = o[0]['properties']['Elect_div'];

	let r = colours[0][0] / 255;
	let g = colours[0][1] / 255;
	let b = colours[0][2] / 255;
	let colour = new Cesium.Color(r,g,b,0.25);

	for(let i in o){
		
		let Elect_div = o[i]['properties']['Elect_div']
	
		if(!repNames[Elect_div]){
			repNames[Elect_div] = 1
		}else{
			repNames[Elect_div] ++
		}
	}

	let k = Object.keys(repNames)
	let colourStep = Math.floor(colours.length / k.length);

	// for(let i in k){
	// 	if(repNames[k[i]] > 1){
	// 		console.log(k[i],repNames[k[i]])
	// 	}
	// }

	let entGroup;

	for(let i in o){

		let E_div_numb = o[i]['properties']['E_div_numb']
		let Elect_div = o[i]['properties']['Elect_div']
		let Numccds = o[i]['properties']['Numccds']
		let Actual = o[i]['properties']['Actual']
		let Projected = o[i]['properties']['Projected']
		let Total_Popu = o[i]['properties']['Total_Popu']
		let Australian = o[i]['properties']['Australian']
		let Area_SqKm = o[i]['properties']['Area_SqKm']
		let Sortname = o[i]['properties']['Sortname']
		let coords = o[i]['geometry']['coordinates'][0]

		let W = o[i]['properties']['boundingBox']['W']
		let E = o[i]['properties']['boundingBox']['E']
		let S = o[i]['properties']['boundingBox']['S']
		let N = o[i]['properties']['boundingBox']['N']

		let midLat = (S + N) / 2
		let midLon = (W + E) / 2
		
		/*************/
		let mp = o[i]['properties']['mp']
		let party = o[i]['properties']['party']
		let tenure = o[i]['properties']['tenure']
		let wiki = o[i]['properties']['wiki']

		let description = `
		<!--Actual:&nbsp;${Actual}<br>-->
		Area:&nbsp;${decimalise(Area_SqKm,0)}&nbsp;km<sup>2</sup><br>
		Member:&nbsp;${mp} - ${party}<br>
		Wiki:&nbsp;<a href="https://en.wikipedia.org/wiki/${wiki}" target="_blank">${Elect_div}</a>
		`
		let boundary = []
		
		if(thisName !== Elect_div || i == 0){//It's a new division - reset colour

			thisCol += Math.max(colourStep,1);
			
			if(thisCol >= colours.length - 1){
				thisCol = 0;
			}

			r = colours[thisCol][0] / 255
			g = colours[thisCol][1] / 255
			b = colours[thisCol][2] / 255
			colour = new Cesium.Color(r,g,b,0.25);

			// let W_ = 180;//lower lon
			// let E_ = -180;//higher lon
			// let S_ = 90;//lower lat
			// let N_ = -90;//higher lat

			for(let i in coords){
				boundary.push(coords[i][0],coords[i][1])

			// 	if(coords[i][0] < W_){W_ = coords[i][0]}
			// 	if(coords[i][0] > E_){E_ = coords[i][0]}
			// 	if(coords[i][1] < S_){S_ = coords[i][1]}
			// 	if(coords[i][1] > N_){N_ = coords[i][1]}
			}

			if(Sortname == 'Fenner'){
				
				W = 180;
				E = -180;
				S = 90;
				N = -90;

				for(let i in coords){
					if(coords[i][0] < W){W = coords[i][0]}
					if(coords[i][0] > E){E = coords[i][0]}
					if(coords[i][1] < S){S = coords[i][1]}
					if(coords[i][1] > N){N = coords[i][1]}
				}

				midLat = (S + N) / 2
				midLon = (W + E) / 2

				description = `
				<!--Actual:&nbsp;${Actual}<br>-->
				Area:&nbsp;${decimalise(Area_SqKm,0)}&nbsp;km<sup>2</sup>&nbsp;(total)<br>
				Member:&nbsp;${mp} - ${party}<br>
				Wiki:&nbsp;<a href="https://en.wikipedia.org/wiki/${wiki}" target="_blank">${Elect_div}</a>
				`
			}

			// midLat = (S_ + N_) / 2
			// midLon = (W_ + E_) / 2

			federal.entities.add({
				// name: `Federal Electorate of ${Elect_div}`,
				name: Elect_div,
				description: description,
				polygon: {
					hierarchy: Cesium.Cartesian3.fromDegreesArray(boundary),
					height: 0,
					material : colour,
					outline : false,
					outlineColor : Cesium.Color.BLACK,
				},
				position: Cesium.Cartesian3.fromDegrees(midLon, midLat, 5000),
				label: {
					text: Elect_div,
					fillColor: Cesium.Color.BLUE,
					scaleByDistance: new Cesium.NearFarScalar(50000, 1.25, 5000000, 0.5),
					translucencyByDistance: new Cesium.NearFarScalar(50000, 0, 100000, 1),
					depthTestAgainstTerrain: false,
					// show: false,
				},
				boundingBox: {W:W,E:E,S:S,N:N},
				colour: colour
			})

			let guid = federal['_entityCollection']['_entities']['_array'][i]['_id']
			entGroup = guid//defined at first polygon in the group

			window['currentEntities'][guid] = federal['_entityCollection']['_entities']['_array'][i]

			federal['_entityCollection']['_entities']['_array'][i]['entGroup'] = entGroup//add the attribute to the entity
			guidSelect['federal'][entGroup] = [guid]//store unique id in an array to loop over

			selections['federal'][Elect_div] = [guid]

			thisName = Elect_div;//string for ivision name
		}else{

			for(let i in coords){
				boundary.push(coords[i][0],coords[i][1])
			}

			federal.entities.add({
				// name: `Federal Electorate of ${Elect_div}`,
				name: Elect_div,
				description: description,
				polygon: {
					hierarchy: Cesium.Cartesian3.fromDegreesArray(boundary),
					height: 0,
					material : colour,
					outline : false,
					outlineColor : Cesium.Color.BLACK,
				},
				boundingBox: {W:W,E:E,S:S,N:N},
				colour: colour,
				entGroup:entGroup//add the entGroup attribute to the entity
			})

			let guid = federal['_entityCollection']['_entities']['_array'][i]['_id']
			window['currentEntities'][guid] = federal['_entityCollection']['_entities']['_array'][i]

			guidSelect['federal'][entGroup].push(guid)//store unique id in an array to loop over
			selections['federal'][Elect_div].push(guid)
		}
	}
	loadStateDivisions(state)
	// console.log(o)
	// console.log(JSON.stringify(o))
	// console.log(viewer.dataSourceDisplay.ready)

	// console.clear()
}

const loadZones = (state)=>{
	let propName = `zones_${state}`
	if(typeof(window[propName]) !== 'object'){
		let info = fetch(`script/zones/${state}.json`,{
			method: 'get',
			headers: {'Content-Type': 'application/json'}
		})
		.then((response) => response.json())
		.then((response) => {
			Object.defineProperty(window, propName, {
				value: response['features'],
				configurable: false,
				writable: false
			})
		})
		.then(() => {
			appendZones(window[propName],state)
		})
		.catch(err => console.error('Caught error: ', err))
	}else{
		appendZones(window[propName],state)
	}
}

const appendZones = (o,state)=>{

	$('.areaSelect option[value="zones"]').prop('disabled',o.length <= 0);
	if(o.length <= 0){
		if($('.areaSelect').val() == 'zones'){
			$('.areaSelect').val('clear')	
		}
		zones.show = false
		loadFederal(state)
		return false;
	}

	let repNames = {}
	let thisCol = 0;
	// console.log(o.length)
	let entGroup
	let thisName = o[0]['properties']['id']

	let r = colours[0][0] / 255;
	let g = colours[0][1] / 255;
	let b = colours[0][2] / 255;
	let colour = new Cesium.Color(r,g,b,0.25);

	/*SETUP FOR BOUNDING BOXES - SAVE RESULT TO JSON FILE - CAPTION OUT WHEN NOT IN USE*/

	let W = 180;//lower lon
	let E = -180;//higher lon
	let S = 90;//lower lat
	let N = -90;//higher lat

	let boxes = {}

	for(let i in o){
		
		let zoneName = o[i]['properties']['id']
		let coords = o[i]['geometry']['coordinates'][0]

		if(!repNames[zoneName]){
			repNames[zoneName] = 1
			boxes[zoneName] = {}
			W = 180;
			E = -180;
			S = 90;
			N = -90;
		}else{
			repNames[zoneName] ++
		}

		for(let i in coords){
			if(coords[i][0] < W){W = coords[i][0]}
			if(coords[i][0] > E){E = coords[i][0]}
			if(coords[i][1] < S){S = coords[i][1]}
			if(coords[i][1] > N){N = coords[i][1]}

			boxes[zoneName]['W'] = W
			boxes[zoneName]['E'] = E
			boxes[zoneName]['S'] = S
			boxes[zoneName]['N'] = N
		}
	}

	for(let i in o){
		let zoneName = o[i]['properties']['id']
		o[i]['properties']['boundingBox'] = boxes[zoneName]
	}

	// console.log(o)
	// console.log(JSON.stringify(o))
	// return false;

	/*SETUP FOR BOUNDING BOXES - SAVE RESULT TO JSON FILE - CAPTION OUT WHEN NOT IN USE*/

	let k = Object.keys(repNames)
	let colourStep = Math.floor(colours.length / k.length);

	for(let i in o){

		let W = o[i]['properties']['boundingBox']['W']
		let E = o[i]['properties']['boundingBox']['E']
		let S = o[i]['properties']['boundingBox']['S']
		let N = o[i]['properties']['boundingBox']['N']

		let midLat = (S + N) / 2
		let midLon = (W + E) / 2

		let zoneName = o[i]['properties']['id']
		let population = o[i]['properties']['population']
		let localities = o[i]['properties']['localities']
		let colour = o[i]['properties']['colour']

		let thisLGAs = o[i]['properties']['lgas'].sort()
		let lgaStr = 'LGAs covered;<ul>'

		for(let i in thisLGAs){
			lgaStr += `<li>${toTitleCase(thisLGAs[i])}</li>`
		}

		lgaStr += '</ul>'

		let description = `
		Population:&nbsp;${population}<br>
		${lgaStr}
		`

		let coords = o[i]['geometry']['coordinates'][0]
		let boundary = []

		if(thisName !== zoneName || i == 0){//It's a new division - reset colour

			thisCol += Math.max(colourStep,1)

			if(thisCol >= colours.length - 1){
				thisCol = 0;
			}
			
			// r = colours[thisCol][0] / 255
			// g = colours[thisCol][1] / 255
			// b = colours[thisCol][2] / 255
			// colour = new Cesium.Color(r,g,b,0.25)//colours for this lot are manually set in the JSON file
		
			let W_ = 180;//lower lon
			let E_ = -180;//higher lon
			let S_ = 90;//lower lat
			let N_ = -90;//higher lat

			for(let i in coords){
				boundary.push(coords[i][0],coords[i][1])

				if(coords[i][0] < W_){W_ = coords[i][0]}
				if(coords[i][0] > E_){E_ = coords[i][0]}
				if(coords[i][1] < S_){S_ = coords[i][1]}
				if(coords[i][1] > N_){N_ = coords[i][1]}
			}

			// let midLat = (S_ + N_) / 2
			// let midLon = (W_ + E_) / 2

			zones.entities.add({
				name: zoneName,
				description: description,
				polygon: {
					hierarchy: Cesium.Cartesian3.fromDegreesArray(boundary),
					height : 0,
					material : Cesium.Color[colour].withAlpha(0.25),
					outline : false,
					outlineColor : Cesium.Color.BLACK,
				},
				position: Cesium.Cartesian3.fromDegrees(midLon, midLat, 250000),
				label: {
					text: zoneName.replace(' - ',`\n`),
					fillColor: Cesium.Color.BLUE,
					scaleByDistance: new Cesium.NearFarScalar(50000, 2, 5000000, 0.5),
					translucencyByDistance: new Cesium.NearFarScalar(10000, 0, 5000000, 1),
					depthTestAgainstTerrain: false,
					// show: false,
				},
				boundingBox: {W:W,E:E,S:S,N:N}
			})
			
			let guid = zones['_entityCollection']['_entities']['_array'][i]['_id']
			entGroup = guid//defined at first polygon in the group

			window['currentEntities'][guid] = zones['_entityCollection']['_entities']['_array'][i]

			zones['_entityCollection']['_entities']['_array'][i]['entGroup'] = entGroup//add the attribute to the entity
			guidSelect['zones'][entGroup] = [guid]//store unique id in an array to loop over

			selections['zones'][zoneName] = [guid]

			thisName = zoneName//string for division name
		}else{

			for(let i in coords){
				boundary.push(coords[i][0],coords[i][1])
			}

			zones.entities.add({
				name: zoneName,
				description: description,
				polygon: {
					hierarchy: Cesium.Cartesian3.fromDegreesArray(boundary),
					height: 0,
					material : colour,
					outline : false,
					outlineColor : Cesium.Color.BLACK,
				},
				boundingBox: {W:W,E:E,S:S,N:N},
				colour: colour,
				entGroup:entGroup//add the entGroup attribute to the entity
			})

			let guid = zones['_entityCollection']['_entities']['_array'][i]['_id']
			window['currentEntities'][guid] = zones['_entityCollection']['_entities']['_array'][i]

			guidSelect['zones'][entGroup].push(guid)//store unique id in an array to loop over
			selections['zones'][zoneName].push(guid)
		}
	}
	loadFederal(state)
	// console.log(o)
}

const loadBroadcast = (state)=>{
	let propName = `broadcast_${state}`
	if(typeof(window[propName]) !== 'object'){
		let info = fetch(`script/broadcast/${state}.json`,{
			method: 'get',
			headers: {'Content-Type': 'application/json'}
		})
		.then((response) => response.json())
		.then((response) => {
			Object.defineProperty(window, propName, {
				value: response['features'],
				configurable: false,
				writable: false
			})
		})
		.then(() => {
			appendBroadcast(window[propName],state)
		})
		.catch(err => console.error('Caught error: ', err))
	}else{
		appendBroadcast(window[propName],state)
	}
}

const appendBroadcast = (o,state)=>{
	// console.log(o.length)
	$('.areaSelect option[value="broadcast"]').prop('disabled',o.length <= 0);
	if(o.length <= 0){
		if($('.areaSelect').val() == 'broadcast'){
			$('.areaSelect').val('clear')	
		}
		broadcast.show = false
		loadZones(state)
		return false;
	}

	let repNames = {}
	let thisCol = 0;
	let entGroup;
	let thisName = o[0]['properties']['id']

	let r = colours[0][0] / 255;
	let g = colours[0][1] / 255;
	let b = colours[0][2] / 255;
	let colour = new Cesium.Color(r,g,b,0.25);

	/*SETUP FOR BOUNDING BOXES - SAVE RESULT TO JSON FILE - CAPTION OUT WHEN NOT IN USE*/

	let W = 180;//lower lon
	let E = -180;//higher lon
	let S = 90;//lower lat
	let N = -90;//higher lat

	let boxes = {}

	for(let i in o){
		
		let id = o[i]['properties']['id']
		let coords = o[i]['geometry']['coordinates'][0]

		if(!repNames[id]){
			repNames[id] = 1
			boxes[id] = {}
			W = 180;
			E = -180;
			S = 90;
			N = -90;
		}else{
			repNames[id] ++
		}

		for(let i in coords){
			if(coords[i][0] < W){W = coords[i][0]}
			if(coords[i][0] > E){E = coords[i][0]}
			if(coords[i][1] < S){S = coords[i][1]}
			if(coords[i][1] > N){N = coords[i][1]}

			boxes[id]['W'] = W
			boxes[id]['E'] = E
			boxes[id]['S'] = S
			boxes[id]['N'] = N
		}
	}

	for(let i in o){
		let id = o[i]['properties']['id']
		o[i]['properties']['boundingBox'] = boxes[id]
	}

	// console.log(o)
	// console.log(JSON.stringify(o))
	// return false;

	/*SETUP FOR BOUNDING BOXES - SAVE RESULT TO JSON FILE - CAPTION OUT WHEN NOT IN USE*/

	let k = Object.keys(repNames)
	let colourStep = Math.floor(colours.length / k.length);

	for(let i in o){

		let W = o[i]['properties']['boundingBox']['W']
		let E = o[i]['properties']['boundingBox']['E']
		let S = o[i]['properties']['boundingBox']['S']
		let N = o[i]['properties']['boundingBox']['N']

		let midLat = (S + N) / 2
		let midLon = (W + E) / 2

		let id = o[i]['properties']['id']
		let people = o[i]['properties']['people']
		let households = o[i]['properties']['households']
		let colour = o[i]['properties']['colour']
		let fta = o[i]['properties']['fta']
		let ftaStr = 'FTA Networks;<ul>'

		for(let i in fta){
			// ftaStr += `<br>${fta[i][0]}&nbsp;-&nbsp;Affiliation:&nbsp;${fta[i][1]}`
			ftaStr += `<li>${fta[i][0]}&nbsp;-&nbsp;Affiliation:&nbsp;${fta[i][1]}</li>`
		}

		ftaStr += '</ul>'

		let description = `
		People:&nbsp;${numberWithCommas(people)}<br>
		Households:&nbsp;${numberWithCommas(households)}<br>
		${ftaStr}
		`

		let coords = o[i]['geometry']['coordinates'][0]
		let boundary = []
		
		if(thisName !== id || i == 0){//It's a new division - reset colour

			for(let i in coords){
				boundary.push(coords[i][0],coords[i][1])
			}

			broadcast.entities.add({
				name: id,
				description: description,
				polygon: {
					hierarchy: Cesium.Cartesian3.fromDegreesArray(boundary),
					height : 0,
					material : Cesium.Color[colour].withAlpha(0.25),
					outline : false,
					outlineColor : Cesium.Color.BLACK,
				},
				position: Cesium.Cartesian3.fromDegrees(midLon, midLat, 250000),
				label: {
					text: id.replace(' - ',`\n`),
					fillColor: Cesium.Color.BLUE,
					scaleByDistance: new Cesium.NearFarScalar(50000, 2, 5000000, 0.5),
					translucencyByDistance: new Cesium.NearFarScalar(10000, 0, 5000000, 1),
					depthTestAgainstTerrain: false,
				},
				boundingBox: {W:W,E:E,S:S,N:N}
			})
			
			let guid = broadcast['_entityCollection']['_entities']['_array'][i]['_id']
			entGroup = guid//defined at first polygon in the group
		
			window['currentEntities'][guid] = broadcast['_entityCollection']['_entities']['_array'][i]

			broadcast['_entityCollection']['_entities']['_array'][i]['entGroup'] = entGroup//add the attribute to the entity
			guidSelect['broadcast'][entGroup] = [guid]//store unique id in an array to loop over

			selections['broadcast'][id] = [guid]

			thisName = id//string for division name
		}else{

			for(let i in coords){
				boundary.push(coords[i][0],coords[i][1])
			}

			broadcast.entities.add({
				name: id,
				description: description,
				polygon: {
					hierarchy: Cesium.Cartesian3.fromDegreesArray(boundary),
					height: 0,
					material : Cesium.Color[colour].withAlpha(0.25),
					outline : false,
					outlineColor : Cesium.Color.BLACK,
				},
				boundingBox: {W:W,E:E,S:S,N:N},
				colour: colour,
				entGroup:entGroup//add the entGroup attribute to the entity
			})

			let guid = broadcast['_entityCollection']['_entities']['_array'][i]['_id']
			window['currentEntities'][guid] = broadcast['_entityCollection']['_entities']['_array'][i]

			guidSelect['broadcast'][entGroup].push(guid)//store unique id in an array to loop over
			selections['broadcast'][id].push(guid)
		}
	}
	loadZones(state)
	// console.log(o)
}

const loadStates = ()=>{
	
	let info = fetch(`script/stateboundaries/stateboundaries.json`,{
		method: 'get',
		headers: {'Content-Type': 'application/json'}
	})
	.then((response) => response.json())
	.then((response) => {
		
		let entGroup
		let o = response['features'];
		let thisName = o[0]['properties']['ST_ABBREV']

		for(let i in o){

			let id = o[i]['properties']['ST_ABBREV']
			let coords = o[i]['geometry']['coordinates'][0]
			let boundary = []

			let r = stateColours[id][0] / 255;
			let g = stateColours[id][1] / 255;
			let b = stateColours[id][2] / 255;

			let colour = new Cesium.Color(r,g,b,0.5);

			for(let i in coords){
				boundary.push(coords[i][0],coords[i][1])
			}

			if(thisName !== id || i == 0){

				stateBoundaries.entities.add({
					name: id,
					polygon: {
						hierarchy: Cesium.Cartesian3.fromDegreesArray(boundary),
						height : 0,
						material : colour,
						outline : false,
						outlineColor : Cesium.Color.BLACK,
					}
				})

				let guid = stateBoundaries['_entityCollection']['_entities']['_array'][i]['_id']
				entGroup = guid//defined at first polygon in the group

				// window['currentEntities'][guid] = stateBoundaries['_entityCollection']['_entities']['_array'][i]

				// guidSelect['stateBoundaries'][entGroup].push(guid)//store unique id in an array to loop over
				// selections['stateBoundaries'][id].push(guid)

				thisName = id;
			}else{

				stateBoundaries.entities.add({
					name: id,
					polygon: {
						hierarchy: Cesium.Cartesian3.fromDegreesArray(boundary),
						height : 0,
						material : colour,
						outline : false,
						outlineColor : Cesium.Color.BLACK,
						entGroup:entGroup//add the entGroup attribute to the entity
					}
				})
			}
		}
	})
	.catch(err => console.error('Caught error: ', err))
}
loadStates();
/*ENTITY FUNCTIONS*/

const baseSelect = (e)=>{
	console.log(viewer.imageryLayers)
}

const stateSelect = (e)=>{
	
	let v;
	if(e.type == 'change'){
		v = e.target.value;
	}else{
		v = e;
	}

	let b = stateBox[v];
	
	window['currentEntities'] = {};

	lgas.entities.removeAll();
	stateDivisions.entities.removeAll();
	federal.entities.removeAll();
	zones.entities.removeAll();
	broadcast.entities.removeAll();
	localities.entities.removeAll();

	selections['lgas'] = {}
	selections['stateDivisions'] = {}
	selections['federal'] = {}
	selections['zones'] = {}
	selections['broadcast'] = {}
	selections['localities'] = {}

	guidSelect['lgas'] = {}
	guidSelect['stateDivisions'] = {}
	guidSelect['federal'] = {}
	guidSelect['zones'] = {}
	guidSelect['broadcast'] = {}
	guidSelect['localities'] = {}

	if(v === 'AUS'){
		e.target.value = 'clear';
		$('#clearStateSelection').html('None')
		$('.areaSelect').prop('disabled',true);
		$('.areaFocus').prop('disabled',true).val('clear');//
		// $('option[value="AUS"]').prop('disabled',true);
		stateBoundaries.show = true;
	}else{
		// loadZones(v);
		loadBroadcast(v);
		// $('option[value="AUS"]').prop('disabled',false);
		$('#clearStateSelection').html('Clear Selection')
	}

	viewer.camera.flyTo({
		destination : Cesium.Rectangle.fromDegrees(b[0],b[1],b[2],b[3])
	});
}

const areaSelect = (e)=>{

	let v = e.target.value;
	let is_lgas = v == 'lgas'
	let is_stateDivisions = v == 'stateDivisions'
	let is_federal = v == 'federal'
	let is_zones = v == 'zones'
	let is_broadcast = v == 'broadcast'

	window['selectedArea'] = v;
	
	if(v == 'deselect'){
		e.target.value = 'clear';
		$('#clearDivisionSelection').html('None')
		stateBoundaries.show = true;
	}else{
		$('#clearDivisionSelection').html('Clear Selection')
		stateBoundaries.show = false;
	}
		
	lgas.show = is_lgas;
	stateDivisions.show = is_stateDivisions;
	federal.show = is_federal;
	zones.show = is_zones;
	broadcast.show = is_broadcast;		
	viewer.selectedEntity = undefined;

	listSelections(v);

	let b = stateBox[$('.stateSelect').val()];
	viewer.camera.flyTo({
		destination : Cesium.Rectangle.fromDegrees(b[0],b[1],b[2],b[3])
	});

	switch(true){
		case is_lgas: $('#dynamicOption').html('Select LGA'); break;
		case is_stateDivisions: $('#dynamicOption').html('Select Electorate'); break;
		case is_federal: $('#dynamicOption').html('Select Electorate'); break;
		case is_zones: $('#dynamicOption').html('Select Zone'); break;
		case is_broadcast: $('#dynamicOption').html('Select Market'); break;
		default: $('#dynamicOption').html('Select Division');
	}
}

/*
for switching imagery provider
https://sandcastle.cesium.com/index.html?src=Imagery%2520Layers%2520Manipulation.html
https://cesium.com/learn/cesiumjs/ref-doc/BaseLayerPicker.html
https://stackoverflow.com/questions/58490396/how-to-change-a-cesiumjs-viewers-baselayer-url
https://cesium.com/learn/cesiumjs/ref-doc/ArcGisMapServerImageryProvider.html
https://cesium.com/learn/cesiumjs/ref-doc/OpenStreetMapImageryProvider.html
https://cesium.com/learn/cesiumjs/ref-doc/ImageryProvider.html
*/

const areaFocus = (e)=>{
	let v = e.target.value;

	if(v == 'deselect'){
		e.target.value = 'clear';
		$('#clearAreaSelection').html('None')

		viewer.trackedEntity = undefined;
		viewer.selectedEntity = undefined;
	}else{
		$('#clearAreaSelection').html('Clear Selection')
	
		let b = window['currentEntities'][v]['boundingBox']
		viewer.selectedEntity = window['currentEntities'][v]
		viewer.camera.flyTo({
			destination : Cesium.Rectangle.fromDegrees(b['W'],b['S'],b['E'],b['N'])
		});
	}

	// console.log(window['currentEntities'])
	// console.log(window['currentEntities'][v])
}

const viewControl = (e)=>{
	let x = $(e.target)	
	let menu = $('.localityFocus')
	localities.show = !localities.show;
	menu.prop('disabled',(!menu.prop('disabled')))
	if(x.hasClass('layerOff')){
		x.removeClass('layerOff')
	}else{
		x.addClass('layerOff')
	}
}
/*FUNCTIONS*/

/*DOM*/
$('.cesium-viewer-toolbar').append(`

	<!--<select class="cesium-button baseSelect">
		<option value="1">Simple Map</option>
		<option value="2">Satellite</option>
	</select>-->

	<select class="cesium-button stateSelect" name="state" id="state">
		<option hidden selected value="clear">State / Territory</option>
		<option value="AUS" id="clearStateSelection">None</option>
		<option value="QLD">Queensland</option>
		<option value="NSW">New South Wales</option>
		<option value="ACT">ACT</option>
		<option value="VIC">Victoria</option>
		<option value="TAS">Tasmania</option>
		<option value="SA">South Australia</option>
		<option value="WA">Western Australia</option>
		<option value="NT">Northern Territory</option</option>
	</select>

	<select disabled class="cesium-button areaSelect">
		<option selected hidden value="clear">Division Type</option>
		<option value="deselect" id="clearDivisionSelection">None</option>
		<option value="lgas">Local Government Areas</option>
		<option value="stateDivisions">State Electorates</option>
		<option value="federal">Federal Electorates</option>
		<option value="zones">News Coverage Zones</option>
		<option value="broadcast">Aggregated Broadcast Markets</option>
	</select>

	<select disabled class="cesium-button areaFocus">
		<option selected hidden value="clear" id="dynamicOption">Select Division</option>
	</select>

	<button class="cesium-button viewControl localities layerOn" id="localities">Localities&nbsp;<span class="on">ON</span>&nbsp;<span class="off">OFF</span></button>

	<!--<select class="cesium-button localityFocus">
		<option selected disabled value="clear">Select Locality</option>
	</select>-->
`)
/*DOM*/

/*BINDINGS*/
$('.baseSelect').change(baseSelect);
$('.stateSelect').change(stateSelect);
$('.areaSelect').change(areaSelect);
$('.viewControl').click(viewControl);
$('.areaFocus').change(areaFocus)

$(window).keyup((e)=>{
	if(e.keyCode == 27){
		viewer.trackedEntity = undefined;
		viewer.selectedEntity = undefined;
	}
})
/*BINDINGS*/